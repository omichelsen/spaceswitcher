(function(e,t,n){"use strict";function o(t,n){this.element=t;this.options=e.extend({},i,n);this._defaults=i;this._name=r;this.init()}var r="spaceswitcher",i={data:[]},s={enter:13,left:37,up:38,right:39,down:40};o.prototype.init=function(){var n=this;n.$widget=e(n.element).append(n.template(n.options.data)).find("."+n._name);e(n.element).on("mouseenter."+n._name,function(){n.$widget.show().find("input").focus();n.resize()}).on("mouseleave."+n._name,function(){n.$widget.hide().find("input").blur()});e(".search-input",n.$widget).on("keydown",function(e){if([s.enter,s.up,s.down].indexOf(e.which)<0)return;e.preventDefault();switch(e.which){case s.enter:t.location=n.getSelected().attr("href");break;case s.up:n.selectPrev();break;case s.down:n.selectNext()}}).on("keyup search",function(t){if([s.enter,s.up,s.down].indexOf(t.which)>=0)return;n.filter(n.unquote(e(this).val()));n.resize();n.setSelected(e(".header:first",n.$widget));n.setSelected(e(".match:first",n.$widget))});e(t).on("resize."+n._name,function(){n.resize()});n.setSelected(e(".header:first",n.$widget))};o.prototype.destroy=function(){e(this.element).off("."+this._name).remove("."+this._name);e(t).off("."+this._name);e.removeData(this.element,"plugin_"+this._name)};o.prototype.filter=function(t){e(".group",this.$widget).children().removeSearch().show().search(t).end().removeHighlight().highlight(t).filter(".item").not(".match").hide().end().end().end().show().not(function(){return e(this).children().hasClass("match")}).hide()};o.prototype.scrollTo=function(e){var t=this.$widget.find(".results"),n=t.height(),r=e.position().top;(r<0||r+e.height()>n)&&t.scrollTop(r)};o.prototype.getSelected=function(){return this.$widget.find(".selected")};o.prototype.setSelected=function(e){if(!e.length)return;this.getSelected().removeClass("selected");this.scrollTo(e);return e.addClass("selected")};o.prototype.selectNext=function(){var e=this.getSelected(),t=e.nextAll(":visible:first");t.length||(t=e.parent().nextAll(":visible:first").children(":visible:first"));t.length&&this.setSelected(t)};o.prototype.selectPrev=function(){var e=this.getSelected(),t=e.prevAll(":visible:first");t.length||(t=e.parent().prevAll(":visible:first").children(":visible:last"));t.length&&this.setSelected(t)};o.prototype.resize=function(){var e=this.$widget.height(),t=this.$widget.find(".search").height(),n=this.$widget.find(".results");n.height("auto");e-t<n.height()&&n.height(e-t)};o.prototype.template=function(e){var t='<div class="'+this._name+'">'+'<div class="search"><div class="inner"><input type="search" class="search-input" /></div></div>'+'<div class="results">'+this.templateResults(e)+"</div>"+"</div>";return t};o.prototype.templateResults=function(t){var n="";e.each(t,function(){n+='<div class="group" style="background-image:url('+this.image.thumbnail_link+')">'+'<a class="header" href="https://podio.com">'+this.name+"</a>";e.each(this.spaces,function(){n+='<a class="item" href="'+this.url+'">'+this.name+"</a>"});n+="</div>"});return n};o.prototype.unquote=function(e){return e.replace(/['"]/g,"")};e.fn[r]=function(t){return this.each(function(){e.data(this,"plugin_"+r)||e.data(this,"plugin_"+r,new o(this,t))})}})(jQuery,window);